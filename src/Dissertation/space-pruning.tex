%!TEX root = ../dissertation.tex

\chapter{Подходы к сокращению пространства поиска, основанные на структурных особенностях автомата} 
\label{sec:pruning}

В данной главе предлагаются новые методы по сокращению пространства поиска в задаче генерации ДКА минимального размера по заданным словарям. 
Данные методы не являются необходимыми для нахождения соответствующего автомата, но помогают сделать это быстрее.
В основе предлагаемых методов лежит использование структурных особенностей BFS пронумерованного ДКА, а также связь между расширенным префиксным деревом и ДКА.

\section{Полное дерево обхода в ширину}
\label{sec:pruning:bfs-tree}

\inote{рисунок дерева}

На рисунке \inote{ссылка} показано полное BFS дерево, построенное по некоторому автомату.
Данное дерево является полным, так как у каждой его внутренней вершины имеется по $L$ детей.
Тогда данное дерево показывает максимально возможные номера, которые могут быть у детей некоторого состояния $d_{i}$.
Действительно, нельзя добавить в данное дерево новые вершины, которые будут иметь номер между $i$ и $i \cdot L + 1$, так как все возможные позиции заняты.
В то же время, если удалить какие-то из вершин правее или ниже вершины $d_{i}$, то номера детей могут только уменьшиться.
Далее будут представлены дополнительные ограничения, которые следуют из рисунка \inote{ссылка}.

\paragraph{Сокращение области определения родительских переменных.}
У некоторого состояния $d_{i}$, где $1 \leq i < M$, детьми в BFS дереве могут быть только состояния с номерами от $i + 1$ до $\min\left(i \cdot L + 1, M\right)$.
Так как в BFS дереве номер ребенка всегда больше номера родителя, то нижняя граница тривиальна.
Рисунок \inote{ссылка} иллюстрирует обоснование верхней границы.
Действительно, можно доказать по индукции, что состояния на $k$-ом уровне имеют номера от $\sum_{r = 0}^{k - 1}L^{r} + 1$ до $\sum_{r = 0}^{k}L^{r}$.
База индукции при $k = 0$, очевидно, верна.
Если для некоторого слоя $k$ утверждение выше верно, то для слоя $k + 1$ верно, что нумерация состояний на нем начинается с $\sum_{r = 0}^{k - 1}L^{r} + 1$, а всего вершин $\left(\sum_{r = 0}^{k}L^{r} - \left(\sum_{r = 0}^{k - 1}L^{r} + 1\right) + 1\right) \cdot L = L^{k} * L = L^{k + 1}$, из чего следует, что последнее состояние имеет номер $\sum_{r = 0}^{k}L^{r} + L^{k + 1} = \sum_{r = 0}^{k + 1}L^{r}$.

\inote{возможно, оформить в виде полноценной теоремы и доказательства.}

Выразить данное свойство можно, либо определив переменные для соответствующей области определения~{---} $\{p_{j,i}\}_{1 \leq i < j \leq min(i \cdot L + 1, M)}$, либо в явном виде указав, что $p_{j,i} = 0$ при $j > i \cdot L + 1$.

\paragraph{Сокращение области определения переменных перехода и переменных наличия переходов.}
Помимо закономерностей между номерами родителей и детей в BFS пронумерованном автомате, можно заметить более общую закономерность относительно переходов.
Из состояния $d_{i}$ в BFS пронумерованном автомате не может в принципе существовать перехода в состояние $d_{j}$ если $j > i \cdot L + 1$.
Действительно, из доказанного в предыдущей секции следует, что у состояния $d_{j}$ родителем должно быть состояние $d_{k}$, где $k > i$.
Но, если существует из состояния $d_{i}$ существует переход в состояние $d_{j}$, то по принципу BFS обхода родителем состояния $d_{j}$ должно быть состояние $d_{k}$, где $k \leq i$.
Получившееся противоречие доказывает исходное утверждение.
Таким образом, можно сделать заключение, что $y_{i,l,j} = 0$ при $j > i \cdot L + 1; l \in \Sigma$.

Как следствие, по определению переменных наличия переходов верно, что $t_{i, j} = 0$ при $j > i \cdot L + 1$.

\inote{$y_{i,l,iL+2-j}$ --- пока скипнул, может добавить про них}

%----------------------------------------------------------------------------------------

\section{Свойство непрерывности родительских переменных}
\label{sec:pruning:continuity}

Помимо того, что у каждого состояния $d_{i}$ автомата $\mathcal{D}$ детьми могут быть состояния с номерами от $i + 1$ до $i \cdot L + 1$, можно утверждать, что состояние $d_{i}$ может быть родителем не более чем $L$ состояний, которые при этом пронумерованны последовательно.
Количество детей ограничено размером алфавита, так как рассматриваемый автомат является детерминированным.
Последовательная нумерация следует из структуры алгоритма BFS~{---} дети некоторого состояния поочередно добавляются в очередь и им присваиваются последовательные номера.
Данное свойство можно назвать \emph{свойством непрерывности}.
Для булевого кодирования предикатов нарушения симметрии данное свойство означает, что для фиксированного $i$ переменные $p_{j,i}$ ложны для всех $j$, кроме некоторого отрезка $[j_{0},\ldots,j_{s}]$, где $1 \leq j_{0} \leq j_{s} \leq M, s\leq L$.

Можно добавить дополнительные ограничения, задающие данное свойство, которые дополнительно ограничат пространство поиска.
Для этого необходимо ввести два дополнительных множества булевых переменных~{---} $\{\mathit{lnp}_{j,i}\}_{1 \leq i < j \leq M}$ и  $\{\mathit{rnp}_{j,i}\}_{1 \leq i < j \leq M}$.

Переменная $\mathit{lnp}_{j,i}$ истинна тогда, когда переменная $p_{j,i} = 0$ и $j < j_{0}$.
Иными словами, данная переменная истинна в случае, когда $j$ находится левее отрезка истинных родительских переменных (\textbf{l}eft \textbf{n}o \textbf{p}arent).
\inote{рисунок}.
Определить на языке выполнимости булевых формул данные переменные можно следующим образом.
Формула $$\bigwedge_{1 \leq i < j \leq M} \neg p_{j,i} \wedge p_{j + 1, i} \rightarrow \mathit{lnp}_{j,i}$$ задает пограничное истинное значение переменных $\mathit{lnp}_{j,i}$.
Далее, необходимо добавить формулу $$\bigwedge_{1 \leq i < M, i + 1 < j \leq M} \mathit{lnp}_{j,i} \rightarrow \mathit{lnp}_{j - 1, i},$$
которая задает значения переменных $\mathit{lnp}_{j,i}$ левее пограничного.
Как следствие из определения переменных $\mathit{lnp}_{j,i}$, можно добавить следующую формулу: $$\bigwedge_{1 \leq i < j \leq M} \mathit{lnp}_{j,i} \rightarrow \neg p_{j,i}.$$
Таким образом, переменные $\mathit{lnp}_{j,i}$ для каждого $i$ истинны начиная с $j = 1$ и до тех пор, пока $p_{j + 1, i}$ не будет истинно.
Можно заметить, что начиная с момента, когда $p_{j,i}$ истинно, значение переменных $\mathit{lnp}_{j,i}$ не определено, что, как будет показано далее, не играет никакой роли.

Аналогичным образом определяются переменные $\mathit{rnp}_{j,i}$.
Переменная $\mathit{rnp}_{j,i}$ истина тогда, когда переменная $p_{j,i} = 0$ и $j > j_{s}$, то есть когда $j$ находится правее отрезка истинных родительских переменных (\textbf{r}ight \textbf{n}o \textbf{p}arent).
Пограничное истинное значение переменных $\mathit{rnp}_{j,i}$ задается с помощью формулы $$\bigwedge_{1 \leq i < j \leq M} p_{j - 1,i} \wedge \neg p_{j, i} \rightarrow \mathit{rnp}_{j,i}.$$
Значение переменных правее пограничного задаются аналогично предыдущему случаю: $$\bigwedge_{1 \leq i < j < M} \mathit{rnp}_{j,i} \rightarrow \mathit{rnp}_{j + 1, i}.$$
Как и в случае с переменными $\mathit{lnp}_{j,i}$, можно добавить формулу $$\bigwedge_{1 \leq i < j \leq M} \mathit{rnp}_{j,i} \rightarrow \neg p_{j,i}.$$
Переменные $\mathit{rnp}_{j,i}$ для каждого $i$ истинны начиная с $j = M$ и в порядке убывания истинны до тех пор, пока $p_{j - 1, i}$ не будет истинно.
Можно заметить, что, аналогично, начиная с $j = 1$, и до тех пор, пока $p_{j,i}$ не станет ложной после серии истинных значений, значение переменных $\mathit{rnp}_{j,i}$ не определено.
Помимо этого, можно добавить следующую формулу: $$\bigwedge_{1 \leq i < j \leq M, l \in \Sigma} \mathit{rnp}_{j,i} \rightarrow \neg y_{i,l,j}.$$
Действительно, если состояние $d_{i}$ имеет детей с номерами $j_{0},\ldots,j_{s}$, то из состояния $d_{i}$ не может быть переходов состояния с номерами б\emph{о}льшими чем $j_{s}$, иначе данные состояния были бы также детьми состояния $d_{i}$. 

Дополнительно, из того, что $d_{i}$ может иметь не более чем $L$ детей, следует, что $$\bigwedge_{1 \leq i < M; i + L < j \leq M - L} p_{j,i} \rightarrow \mathit{lnp}_{j - L, i}$$ и что $$\bigwedge_{1 \leq i < j \leq M - L} p_{j,i} \rightarrow \mathit{rnp}_{j + L, i}.$$

Переменные $\mathit{lnp}_{j,i}$ и $\mathit{rnp}_{j,i}$ помогают задать некоторым переменным $p_{j,i}$ ложное значение.
Однако, исходя из их значения, можно некоторым переменным $p_{j,i}$ задать истинное значение.
Так, если для некоторых $j_{1} < j_{2}$ верно, что $\mathit{lnp}_{j_{1}, i}$ и $\mathit{rnp}_{j_{2}, i}$ ложны, то для всех $j'$ таких, что $j_{1} \leq j' \leq j_{2}$ верно, что $p_{j',i}$ истинна.
Формально, $$\bigwedge_{1 \leq i < M;i < j_{1} \leq j' \leq j_{2} \leq \min\left(j_{1} + L - 1, M\right)} \neg \mathit{lnp}_{j_{1},i} \wedge \neg \mathit{rnp}_{j_{2},i} \rightarrow p_{j',i}.$$

Также, учитывая, что дети некоторого состояния $d_{i}$ пронумерованны последовательно, можно добавить следующее ограничение: $$\bigwedge_{1 \leq i < j < k \leq \min(j + L - 1, M)} p_{j,i} \wedge p_{k,i} \rightarrow p_{k - 1, i}.$$ 